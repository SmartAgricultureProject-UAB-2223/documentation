\section{Implementation options}
We present below different possible implementations of the previous diagram.

\subsection{Sensors}
The tables below show the different options for the four sensors required in our HPCS system.

\begin{table}[!h]
    \centering
    \begin{tabular}{c c c}
        \hline
        \textbf{Manufacturer} & GAOHOU & DFRobot\\
        \hline
        \textbf{Model} & \href{https://www.amazon.com/GAOHOU-PH0-14-detecci%C3%B3n-electrodo-Arduino/dp/B0799BXMVJ/ref=sr_1_1_sspa?keywords=pH+Sensor+Arduino&qid=1667674873&sr=8-1-spons&psc=1}{YY6237} & \href{https://www.dfrobot.com/product-1025.html}{SEN0161}\\
        \textbf{Working temperature (℃)} & -10 ~ 50 & 0 ~ 60\\
        \textbf{Response time (S)} & $\leq$ 5 & $\leq$ 60\\
        \textbf{pH range} & 0 - 14 & 0 - 14\\
        \textbf{Voltage (V)} & ~5 & ~5\\
        \textbf{Current (mA)} & 5-10 & -\\
        \textbf{Size (cm)} & 4.5 x 3.2 & 4.3 x 3.2\\
        \textbf{Weight (g)} & 136 & 160\\
        \textbf{Price 1 unit (\$)} & 34.99 & 29.50\\
        \textbf{Price 100 units (\$)} & 34.99 & 27.00\\
        \hline
        \end{tabular} 
    \caption{pH sensor comparison}
    \label{tab:ph_sensor_comparison}
\end{table}

\begin{table}[!h]
    \centering
    \scriptsize
    \begin{tabular}{c c c c}
        \hline
        \textbf{Manufacturer} & Adafruit & DFRobot & SparkFun\\
        \hline
        \textbf{Model} & \href{https://www.adafruit.com/product/4832}{HTU31} & \href{https://www.dfrobot.com/product-1102.html}{SEN0137 (DHT22)} & \href{https://www.sparkfun.com/products/13763#reviews}{SEN-13763}\\
        \textbf{Temperature range (℃)} & -40 ~ +125 & -40 ~ + 80 & -40 ~ +125\\
        \textbf{Accuracy (℃)} & ± 0.2 & ± 0.5 & ± 0.4\\
        \textbf{Humidity range (\%RH)} & 0-100 & 0-100 & 0-100\\
        \textbf{Accuracy (\%RH)} & ± 2 & ± 2 & ± 3\\
        \textbf{Voltage (V)} & 3.3 - 5 & 5 & 1.9 - 3.6\\
        \textbf{Current (µA)} & 1.04 & 1 500 & 150\\
        \textbf{Size (cm)} & 2.5 x 1.7 & 3.8 x 2.0 & 1.5 x 1.5\\
        \textbf{Weight (g)} & 1.6 & 13 & 1.3\\
        \textbf{Price 1 unit (\$)} & 6.95 & 8.70 & 10.95\\
        \textbf{Price 100 units (\$)} & 5.56 & 8.30 & 10.95\\
        \hline
        \end{tabular}
    \caption{Temperature - Humidity sensor comparison}
    \label{tab:temp_hum_sensor_comparison}
\end{table}

\begin{table}[!h]
    \centering
    \begin{tabular}{c c c c}
        \hline
        \textbf{Manufacturer} & Adafruit & Adafruit & DFRobot\\
        \hline
        \textbf{Model} & \href{https://www.adafruit.com/product/4681}{BH1750} & \href{https://learn.adafruit.com/tsl2561}{TSL2591} & \href{https://www.dfrobot.com/product-274.html}{SEN0043}\\
        \textbf{Light range (lux)} & 1 - 65535 & 0,000188 - 88000 & 1 – 1000\\
        \textbf{Waterproof} & No & No & No\\
        \textbf{Voltage (V)} & 3.3 - 6 & 3.3 - 5 & 3.3 - 5.5\\
        \textbf{Current (mA)} & 0.12 & 0.5 & 20\\
        \textbf{Size (cm)} & 2.5 x 1.7 & 1.9 x 1.6 & 3.0 x 2.2\\
        \textbf{Weight (g)} & 1.1 & 1.1 & 5\\
        \textbf{Price 1 unit (\$)} & 4.50 & 6.95 & 5.90\\
        \textbf{Price 100 units (\$)} & 3.60 & 5.56 & 5.30\\
        \hline
        \end{tabular}
    \caption{Light Sensor comparison}
    \label{tab:light_sensor_comparison}
\end{table}

\subsection{Battery}
The table below compares some non-rechargeable button cell batteries that would be suitable for our system \cite{b7}.
They are very similar to each other but can differ in their lifetime and size. Prices are those of the seller Ace Hardware.
\begin{table}[!h]
    \scriptsize
    \centering
    \begin{tabular}{c c c c c c}
        \hline
        \textbf{Model} & \href{https://www.energizer.com/specialty-batteries/2032-battery}{CR2032} & \href{https://www.energizer.com/specialty-batteries/2025-battery}{CR2025} & \href{https://www.energizer.com/specialty-batteries/2016-battery}{CR2016} & \href{https://www.energizer.com/specialty-batteries/2450-battery}{CR2450} & \href{https://www.energizer.com/specialty-batteries/1632-battery}{CR1632}\\
        \hline
        \textbf{Voltage (V)} & 3.0 & 3.0 & 3.0 & 3.0 & 3.0\\
        \textbf{Capacity (mAh)} & 235 & 170 & 100 & 620 & 130\\
        \textbf{Size (mm)} & 20.0×3.2 & 20.0×2.5 & 20.0×1.6 & 24.0×5.0 & 16.0×3.2\\
        \textbf{Weight (g)} & 3.0 & 2.6 & 1.9 & 6.8 & 1.8\\
        \textbf{Price (\$)} & 6.59 & 6.59 & 6.59 & 7.59 & 7.59\\
        \hline
        \end{tabular}
    \caption{Battery comparison - Energizer Manufacturer}
    \label{tab:battery_comparison}
\end{table}

\subsection{Computing platforms}
\subsubsection{Arduinos and alternative platforms}
There are many boards available on the market, most of which would be suitable for
our system. The following comparison between some of them is based on price, size,
and power consumption.
\begin{table}[!h]
    \centering
    \begin{tabular}{c c c c c}
        \hline
        \textbf{Platform} & \textbf{Price} & \textbf{Size (mm)} & \textbf{BLE} & \textbf{Input pins} \\
        \hline
        Arduino Nano 33 & €22.80 & $45 \times 18$ & Yes & 14 \\
        ESP32-PICO-D4 & €4.95 & $7 \times 7$ & Yes & 20 \\
        ATmega328 Nano & €8.95 & $44 \times 18$ & No & 14 \\
        \hline
        \end{tabular}
    \caption{Arduinos and alternative platforms}
    \label{tab:arduinos_alternative_platforms}
\end{table}

All these boards are very similar in terms of power consumption and programming
capabilities, making any comparison on that front irrelevant.

The Arduino Nano 33 is the most expensive of the three, but it is also the most
supported. ATmega328 Nano is cheaper and smaller, while being fundamentally the
same, although it's missing a Bluetooth Low Energy module. ESP32-PICO-D4 is the
cheapest, while also coming with a Bluetooth Low Energy module. Availability of
development kits means that the board chosen for the final design might not be the
same as the board used in the proof of concept and prototyping phase. \\

\subsubsection{Edge computing}
It's been established that a phone or a tablet will act as the edge device in this
system, with focus on remaining compatible with reasonably-recent Android and iOS
devices. \\
The possible frameworks to use for developing the app are React Native, Flutter,
and NativeScript. Of these, React Native and NativeScript use JavaScript, while
Flutter uses the Dart programming language. React Native is the most popular of
the three, while Flutter is the newest and natively integrates with the Google
"Material Design" guidelines. NativeScript is the least popular of the three, but
it allows the usage of a large number of existing JavaScript frameworks and libraries
while still compiling to a native app. \\

\subsubsection{Cloud options}
The available hosting options, cloudwise, are all quite similar. They all
provide a platform to host any web component of the application and database services
to store the data. The main differences are in pricing and complexity of usage and
maintenance. The table below shows the main differences between the two main
options considered: AWS and Azure. The table is based on the assumption
that the web component will be hosted on a Linux server and the database will be
hosted in a non-relational database (NoSQL) service (e.g. MongoDB, DynamoDB, etc.),
ignoring free tier options (they are not relevant for our purposes, as the system will
eventually be deployed in a real-world scenario where the limitations of the free
tier are not relevant) and with yearly contracts in mind.

\begin{table}[!h]
    \centering
    \begin{tabular}{c c c}
        \hline
        \textbf{Feature} & \textbf{AWS} & \textbf{Azure} \\
        \hline
        Database Pricing &
            \$0.25/GB per month & \$0.25/GB per month \\
         & \$1.25/m writes & \$0.28/m requests \\
         & \$0.25/m reads \\
         \hline
        Linux Server Pricing &
            \$10/month (T2.small) & 
            \$10/month (B1ms) \\
        \hline
        \end{tabular}
    \caption{Cloud options}
    \label{tab:cloud_options}
\end{table}

As seen, the main difference is in the database pricing. AWS is cheaper for reads,
but Azure is cheaper for writes. The Linux server pricing is the same for both options
at the size we're looking at. Additionally, Azure offers an IoT Hub service that
could replace some of the functionality of the web component.
\subsection{Data formats}
\subsubsection*{Storing data on the device}
It is important to choose a data format that is easy to parse programmatically and
can be easily transmitted to the edge device. The most basic data format could simply
be raw bytes, allocating a certain number of bytes for each sensor reading plus the
time. While simple, easy to parse and computationally efficient, this format would
require a lot of bandwidth when sent over a wireless network, and over time it would
occupy a lot of space on the device. A more complex solution would be saving only some
measurements (e.g. one every hour, or when the edge device pulls the data), while
the rest are saved as deltas from the last measurement. This would mean that, in
standard usage, the device could possibly be storing only a few bytes per hour, but
it comes at the cost of either more complex parsing on the edge device, or more
computation on the device itself. \\

\subsubsection*{Data aggregation and transmission}
Deciding where and how to aggregate the data is a key decision in the design of the
system. On the device, the data should be kept as unprocessed as possible, to allow the device
and the edge device to access at least once the raw sensor readings. It's when the data
gets to the edge device that the problem becomes more interesting. It would probably
be better to remove any redundant readings as soon as possible, to reduce the amount of
data sent to the cloud uselessly. This would go well with the idea of storing only
differences between measurements, as it would allow the edge device to simply discard
any "blank" deltas it receives.

\subsection{Device-Edge communication protocols}
The high latency brought on by a sensor device's mobility for remote monitoring in edge-based IoT applications can have detrimental effects including erroneous analysis and poor service quality \cite{b5}. In order to reduce latency and while maintaining a connection, high quality of service, and energy efficiency, mobility support approaches are necessary. Therefore for our IOT solution we will be using a wireless connection for the communication Device-edge: Bluetooth. 
\subsubsection{Bluetooth types}
Bluetooth is a short-range wireless technology medium used for exchanging data between two electronic devices over a short distance. 
UHF radio waves, often known as short wave radio, are used by Bluetooth exchange to create a Personal Area Network employing radio bands ranging from 2.402 GHz to 2.480 GHz.

Since there are two Bluetooth types, Bluetooth Classic and Bluetooth Low Energy (BLE), all Bluetooth devices can be divided into these two categories. On the one hand, wireless speakers, headsets, and automotive infotainment systems frequently use the Bluetooth Classic standard. Bluetooth Low Energy, on the other hand, is more common in applications that focus on battery consumption and transfer small amounts of data less frequently. To put it another way, BLE is frequently found in battery-operated gadgets like cell phones, sensor devices, etc. While keeping a similar communication range to Bluetooth Classic, Bluetooth Low Energy survives on lower power consumption and costs. This is in contrast to Bluetooth Classic, which uses a lot of energy.

\begin{table}[htbp]
    \centering
    \begin{tabular}{|c|c|c|}
        \hline
        \textbf{Bluetooth} & \textbf{Classic} & \textbf{Low Energy}  \\
        \hline
        Data payload throughput & 2Mbps & ~100 kbps\\
        \hline
        Robustness & Strong & Strong\\
        \hline
        Range & Up to 1000m & Up to 250m\\
        \hline
        Local System density & Strong & Strong\\
        \hline
        Large scale network & Weak & Good\\
        \hline
        Low latency & Strong & Strong\\
        \hline
        Connection set-up speed & Weak & Strong\\
        \hline
        Power consumption & Good & Very strong\\
        \hline
        Cost & Good & Strong \\
        \hline
        \end{tabular}
    \caption{Comparison between Bluetooth Classic and Low Energy (BLE) \cite{b4}}
    \label{tab:my_label}
\end{table}

\subsubsection{Bluetooth in IOT}
By keeping IoT devices in sleep mode while not in use and allowing users to wake them up when connected or reconnected, Bluetooth Low Energy in IoT can help IoT devices save energy. Because IoT BLE apps can swiftly pair and reconnect with devices in six milliseconds as opposed to traditional Bluetooth applications that must wait six seconds or longer, Bluetooth Low Energy is perfect for IoT applications.

Considering the usage of both Bluetooth options as well as their specificities summarized in the comparison table, why we have decided to use Bluetooth Low Energy for our project through the BLEPeripheral library.

\subsection{Edge-Cloud communication protocols}
IoT Hub allows devices to use alternative protocols for Edge-Cloud communications, such as HTTP/HTTPS, MQTT and AMQP \cite{b1}. In this section we will try to compare each of those protocols and see which ones would suit our project the best.

\subsubsection{MQTT} is a communication protocol with features specifically targeted at IoT solutions. With a small code footprint and low network bandwidth requirements, it is designed as a lightweight publish/subscribe messaging transport that is perfect for linking remote devices.\\
The ease and flexibility with which solutions can be developed is one of MQTT's best features. Multiple clients can produce and share information with back end systems and each other thanks to the publish-subscribe paradigm.

\subsubsection{AMQP} is a messaging protocol which was created to be a non-proprietary method of connecting applications and was not targeted at IoT solutions. It is used on field and cloud gateways to take advantage of connection multiplexing across devices. One of its benefits is that, while being a complicated messaging system, it is lightweight, has little overhead\footnote{The information that must be sent with data being routed through the network toward a destination.}, and uses minimal CPU and RAM. \\
For general purpose message queuing, AMQP offers more flexibility than MQTT, at the expense of some efficiency and complexity. However it places a strong emphasis on message delivery that adds to the overhead eventually.

\subsubsection{HTTPS} is a heavy text-based protocol working on a request/response model. A client sends a request to the server, and the server sends back a response.\\
The main benefit of HTTPS for use in IoT is its familiarity to developers which are likely to have had implemented web solutions of one kind or another. A consequence of this is the availability of client libraries and servers. Additionally it is scalable and can be used with multiple devices.\\

As MQTT was designed for IoT solutions it fits many more IoT scenarios than its counterparts. \\
Will and retained messages are two MQTT capabilities that AMQP does not directly support \cite{b2}. Moreover, mistakes might be made when configuring routing topologies of AMQP, which is impossible in the more straightforward MQTT environment.\\
The cost of connection setup is a small drawback of MQTT versus HTTPS. This overhead may be higher than HTTPS if each TCP session only sends one message. However, because this is not a typical IoT case, MQTT soon becomes advantageous when several messages are transmitted and received within the same TCP session \cite{b3}. HTTPS also needs more power and memory to function than MQTT.\\

Considering the advantages and disadvantages of the different protocols listed above and taking into account the comparison table [cf Annexe : Table \ref{edge-cloud protocols}].
It seems like the best protocols to implement for the HPCS would be MQTT or HTTPS protocols with a preference for MQTT.